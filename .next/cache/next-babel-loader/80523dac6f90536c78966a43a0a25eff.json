{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport axios from 'axios';\nimport { connect } from 'react-redux';\nimport { reauthenticate, getCookie, checkServerSideCookie } from '../actions/authActions';\nimport Router from 'next/router';\nimport Layout from '../components/Layout/Layout';\n\nvar Whoami = function Whoami(_ref) {\n  var user = _ref.user;\n  return __jsx(Layout, {\n    title: \"Who Am I\"\n  }, user && __jsx(React.Fragment, null, __jsx(\"h2\", null, \"Who im i\"), _JSON$stringify(user)) || 'Please sign in');\n};\n\nWhoami.getInitialProps =\n/*#__PURE__*/\nfunction () {\n  var _ref2 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(ctx) {\n    var _token, _token2, token;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            checkServerSideCookie(ctx);\n\n            if (ctx.isServer) {\n              if (ctx.req.headers.cookie) {\n                _token = getCookie('token', ctx.req);\n                console.log('WHOAMI ', _token);\n                ctx.store.dispatch(reauthenticate(_token));\n              }\n            } else {\n              _token2 = ctx.store.getState().authentication.token;\n\n              if (_token2 && (ctx.pathname === '/signin' || ctx.pathname === '/signup')) {\n                setTimeout(function () {\n                  Router.push('/');\n                }, 0);\n              }\n            }\n\n            token = ctx.store.getState().authentication.token;\n\n            if (!token) {\n              _context.next = 5;\n              break;\n            }\n\n            return _context.abrupt(\"return\", {\n              user: 'Ryan'\n            });\n\n          case 5:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexport default connect(function (state) {\n  return state;\n}, {\n  reauthenticate: reauthenticate\n})(Whoami);","map":{"version":3,"sources":["G:/Phinp/Rect-Redux-Nextjs/pages/whoami.js"],"names":["axios","connect","reauthenticate","getCookie","checkServerSideCookie","Router","Layout","Whoami","user","getInitialProps","ctx","isServer","req","headers","cookie","token","console","log","store","dispatch","getState","authentication","pathname","setTimeout","push","state"],"mappings":";;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,SAASC,cAAT,EAAyBC,SAAzB,EAAoCC,qBAApC,QAAkE,wBAAlE;AACA,OAAOC,MAAP,MAAmB,aAAnB;AACA,OAAOC,MAAP,MAAmB,6BAAnB;;AAEA,IAAMC,MAAM,GAAE,SAARA,MAAQ;AAAA,MAAEC,IAAF,QAAEA,IAAF;AAAA,SACV,MAAC,MAAD;AAAQ,IAAA,KAAK,EAAG;AAAhB,KACMA,IAAI,IACF,4BACA,6BADA,EAEK,gBAAeA,IAAf,CAFL,CADH,IAKI,gBANT,CADU;AAAA,CAAd;;AAWAD,MAAM,CAACE,eAAP;AAAA;AAAA;AAAA;AAAA;AAAA,2BAAyB,iBAAMC,GAAN;AAAA;;AAAA;AAAA;AAAA;AAAA;AACrBN,YAAAA,qBAAqB,CAACM,GAAD,CAArB;;AACA,gBAAGA,GAAG,CAACC,QAAP,EAAgB;AACZ,kBAAID,GAAG,CAACE,GAAJ,CAAQC,OAAR,CAAgBC,MAApB,EAA4B;AAClBC,gBAAAA,MADkB,GACVZ,SAAS,CAAC,OAAD,EAAUO,GAAG,CAACE,GAAd,CADC;AAExBI,gBAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuBF,MAAvB;AACAL,gBAAAA,GAAG,CAACQ,KAAJ,CAAUC,QAAV,CAAmBjB,cAAc,CAACa,MAAD,CAAjC;AACD;AACN,aAND,MAMO;AACDA,cAAAA,OADC,GACOL,GAAG,CAACQ,KAAJ,CAAUE,QAAV,GAAqBC,cAArB,CAAoCN,KAD3C;;AAGP,kBAAIA,OAAK,KAAKL,GAAG,CAACY,QAAJ,KAAiB,SAAjB,IAA8BZ,GAAG,CAACY,QAAJ,KAAiB,SAApD,CAAT,EAAyE;AACvEC,gBAAAA,UAAU,CAAC,YAAW;AACpBlB,kBAAAA,MAAM,CAACmB,IAAP,CAAY,GAAZ;AACD,iBAFS,EAEP,CAFO,CAAV;AAGD;AACF;;AACMT,YAAAA,KAjBgB,GAiBRL,GAAG,CAACQ,KAAJ,CAAUE,QAAV,GAAqBC,cAArB,CAAoCN,KAjB5B;;AAAA,iBAkBlBA,KAlBkB;AAAA;AAAA;AAAA;;AAAA,6CAmBV;AAACP,cAAAA,IAAI,EAAE;AAAP,aAnBU;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAzB;;AAAA;AAAA;AAAA;AAAA;;AAuBA,eAAeP,OAAO,CAAC,UAAAwB,KAAK;AAAA,SAAIA,KAAJ;AAAA,CAAN,EAAiB;AAAEvB,EAAAA,cAAc,EAAdA;AAAF,CAAjB,CAAP,CAA4CK,MAA5C,CAAf","sourcesContent":["import axios from 'axios';\r\nimport { connect } from 'react-redux';\r\nimport { reauthenticate, getCookie, checkServerSideCookie  } from '../actions/authActions';\r\nimport Router from 'next/router';\r\nimport Layout from '../components/Layout/Layout';\r\n\r\nconst Whoami =({user}) => (\r\n    <Layout title = \"Who Am I\">\r\n        {(user &&  (\r\n            <>\r\n            <h2>Who im i</h2>\r\n                {JSON.stringify(user)}\r\n            </>\r\n        )) ||'Please sign in'}\r\n    </Layout>\r\n)\r\n\r\nWhoami.getInitialProps = async ctx =>  {\r\n    checkServerSideCookie(ctx);\r\n    if(ctx.isServer){\r\n        if (ctx.req.headers.cookie) {\r\n            const token = getCookie('token', ctx.req);\r\n            console.log('WHOAMI ', token);\r\n            ctx.store.dispatch(reauthenticate(token));\r\n          }\r\n    } else {\r\n    const token = ctx.store.getState().authentication.token;\r\n\r\n    if (token && (ctx.pathname === '/signin' || ctx.pathname === '/signup')) {\r\n      setTimeout(function() {\r\n        Router.push('/');\r\n      }, 0);\r\n    }\r\n  }\r\n   const token = ctx.store.getState().authentication.token;\r\n    if(token){\r\n        return {user: 'Ryan'};\r\n    }\r\n}\r\n\r\nexport default connect(state => state, { reauthenticate })(Whoami);"]},"metadata":{},"sourceType":"module"}