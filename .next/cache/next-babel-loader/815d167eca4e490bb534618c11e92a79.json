{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport { AUTHENTICATION, DEAUTHENTICATION } from '../constants/constants';\nimport cookie from 'js-cookie';\nimport Router from 'next/router';\nexport var authentication = function authentication(user) {\n  return function (dispatch) {\n    return fetch(\"http://localhost:8000/api/signin\", {\n      method: 'POST',\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'application/json'\n      },\n      body: _JSON$stringify(user)\n    }).then(function (data) {\n      return data.json();\n    }).then(function (res) {\n      setCookie('token', response.token);\n      Router.push('/');\n      dispatch({\n        type: AUTHENTICATION,\n        payload: res.token\n      });\n    })[\"catch\"](function (err) {\n      return console.log(err);\n    });\n  };\n};\nexport var setCookie = function setCookie(key, value) {\n  if (process.browser) {\n    Cookie.set(key, value, {\n      exprires: 1,\n      path: '/'\n    });\n  }\n};\nexport var removeCookie = function removeCookie(key) {\n  if (process.browser) {\n    cookie.remove(key, {\n      exprires: 1\n    });\n  }\n};\nexport var getCookie = function getCookie(key, req) {\n  return process.browser ? getCookieFromBrowser(key) : getCookieFromServer(key, req);\n};\n\nvar getCookieFromBrowser = function getCookieFromBrowser(key) {\n  return cookie.get(key);\n};\n\nvar getCookieFromServer = function getCookieFromServer(key, req) {\n  if (!req.headers.cookie) {\n    return undefined;\n  }\n\n  var rawCookie = req.headers.cookie.split(';').find(function (c) {\n    return c.trim().startsWith(\"\".concat(key, \"=\"));\n  });\n\n  if (!rawCookie) {\n    return undefined;\n  }\n\n  return rawCookie.split('=')[1];\n};\n\nexport var reauthenticate = function reauthenticate(token) {\n  return function (dispatch) {\n    return dispatch({\n      type: AUTHENTICATION,\n      payload: token\n    });\n  };\n};\nexport var deauthenticate = function deauthenticate() {\n  return function (dispatch) {\n    removeCookie('token');\n    Router.push('/');\n    dispatch({\n      type: DEAUTHENTICATION\n    });\n  };\n};\nexport var checkServerSideCookie = function checkServerSideCookie(ctx) {\n  if (ctx.isServer) {\n    if (ctx.req.headers.cookie) {\n      var token = getCookie('token', ctx.req);\n      ctx.store.dispatch(reauthenticate(token, user));\n    }\n  } else {\n    var _token = ctx.store.getState().authentication.token;\n\n    if (_token && user && (ctx.pathname === '/signin' || ctx.pathname === '/signup')) {\n      setTimeout(function () {\n        Router.push('/');\n      }, 0);\n    }\n  }\n};","map":{"version":3,"sources":["G:/Phinp/Rect-Redux-Nextjs/actions/authActions.js"],"names":["AUTHENTICATION","DEAUTHENTICATION","cookie","Router","authentication","user","dispatch","fetch","method","headers","Accept","body","then","data","json","res","setCookie","response","token","push","type","payload","err","console","log","key","value","process","browser","Cookie","set","exprires","path","removeCookie","remove","getCookie","req","getCookieFromBrowser","getCookieFromServer","get","undefined","rawCookie","split","find","c","trim","startsWith","reauthenticate","deauthenticate","checkServerSideCookie","ctx","isServer","store","getState","pathname","setTimeout"],"mappings":"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","sourcesContent":["import { AUTHENTICATION, DEAUTHENTICATION } from '../constants/constants';\r\nimport cookie from 'js-cookie';\r\nimport Router from 'next/router';\r\nexport const authentication = user => dispatch => \r\n    fetch(`http://localhost:8000/api/signin`, {\r\n        method: 'POST',\r\n        headers: {\r\n            Accept: 'application/json',\r\n            'Content-Type':'application/json'\r\n        },\r\n        body: JSON.stringify(user)\r\n    })\r\n    .then(data => data.json())\r\n    .then(res =>\r\n       {\r\n        setCookie('token', response.token);\r\n        Router.push('/');\r\n         dispatch({type: AUTHENTICATION, payload: res.token})\r\n       })\r\n    .catch(err => console.log(err));\r\n\r\nexport const setCookie = (key, value) => {\r\n    if(process.browser){\r\n        Cookie.set(key, value, {\r\n            exprires: 1,\r\n            path: '/'\r\n        })\r\n    }\r\n};\r\n\r\nexport const removeCookie = key => {\r\n    if(process.browser){\r\n        cookie.remove(key, {\r\n            exprires: 1\r\n        })\r\n    }\r\n}\r\n\r\nexport const getCookie = (key, req) => {\r\n    return  process.browser ? getCookieFromBrowser(key) : getCookieFromServer(key,req);\r\n}\r\n\r\nconst getCookieFromBrowser = key => {\r\n    return cookie.get(key)\r\n}\r\n\r\nconst getCookieFromServer = (key, req) => {\r\n    if(!req.headers.cookie){\r\n        return undefined;\r\n    }\r\n\r\n    const rawCookie = req.headers.cookie.split(';').find(c => c.trim().startsWith(`${key}=`));\r\n    if(!rawCookie){\r\n        return undefined;\r\n    }\r\n\r\n    return rawCookie.split('=')[1];\r\n}\r\n\r\nexport const reauthenticate = token => dispatch => (dispatch({type: AUTHENTICATION, payload: token}));\r\n\r\nexport const deauthenticate = () => dispatch => {\r\n    removeCookie('token');\r\n    Router.push('/');\r\n    dispatch({type: DEAUTHENTICATION});\r\n}\r\n\r\n\r\nexport const checkServerSideCookie = ctx => {\r\n    if (ctx.isServer) {\r\n        if (ctx.req.headers.cookie) {\r\n            const token = getCookie('token', ctx.req);\r\n            ctx.store.dispatch(reauthenticate(token, user));\r\n        }\r\n    } else {\r\n        const token = ctx.store.getState().authentication.token;\r\n\r\n        if (token && user && (ctx.pathname === '/signin' || ctx.pathname === '/signup')) {\r\n            setTimeout(function() {\r\n                Router.push('/');\r\n            }, 0);\r\n        }\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}