{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport { AUTHENTICATION, DEAUTHENTICATION } from '../constants/constants';\nimport cookie from 'js-cookie';\nimport Router from 'next/router';\nexport const authentication = user => dispatch => fetch(`http://localhost:8000/api/signin`, {\n  method: 'POST',\n  headers: {\n    Accept: 'application/json',\n    'Content-Type': 'application/json'\n  },\n  body: _JSON$stringify(user)\n}).then(data => data.json()).then(res => {\n  setCookie('token', response.token);\n  Router.push('/');\n  dispatch({\n    type: AUTHENTICATION,\n    payload: res.token\n  });\n}).catch(err => console.log(err));\nexport const setCookie = (key, value) => {\n  if (process.browser) {\n    Cookie.set(key, value, {\n      exprires: 1,\n      path: '/'\n    });\n  }\n};\nexport const removeCookie = key => {\n  if (process.browser) {\n    cookie.remove(key, {\n      exprires: 1\n    });\n  }\n};\nexport const getCookie = (key, req) => {\n  return process.browser ? getCookieFromBrowser(key) : getCookieFromServer(key, req);\n};\n\nconst getCookieFromBrowser = key => {\n  return cookie.get(key);\n};\n\nconst getCookieFromServer = (key, req) => {\n  if (!req.headers.cookie) {\n    return undefined;\n  }\n\n  const rawCookie = req.headers.cookie.split(';').find(c => c.trim().startsWith(`${key}=`));\n\n  if (!rawCookie) {\n    return undefined;\n  }\n\n  return rawCookie.split('=')[1];\n};\n\nexport const reauthenticate = token => dispatch => dispatch({\n  type: AUTHENTICATION,\n  payload: token\n});\nexport const deauthenticate = () => dispatch => {\n  removeCookie('token');\n  Router.push('/');\n  dispatch({\n    type: DEAUTHENTICATION\n  });\n};\nexport const checkServerSideCookie = ctx => {\n  if (ctx.isServer) {\n    if (ctx.req.headers.cookie) {\n      const token = getCookie('token', ctx.req);\n      ctx.store.dispatch(reauthenticate(token, user));\n    }\n  } else {\n    const token = ctx.store.getState().authentication.token;\n\n    if (token && user && (ctx.pathname === '/signin' || ctx.pathname === '/signup')) {\n      setTimeout(function () {\n        Router.push('/');\n      }, 0);\n    }\n  }\n};","map":{"version":3,"sources":["G:/Phinp/Rect-Redux-Nextjs/actions/authActions.js"],"names":["AUTHENTICATION","DEAUTHENTICATION","cookie","Router","authentication","user","dispatch","fetch","method","headers","Accept","body","then","data","json","res","setCookie","response","token","push","type","payload","catch","err","console","log","key","value","process","browser","Cookie","set","exprires","path","removeCookie","remove","getCookie","req","getCookieFromBrowser","getCookieFromServer","get","undefined","rawCookie","split","find","c","trim","startsWith","reauthenticate","deauthenticate","checkServerSideCookie","ctx","isServer","store","getState","pathname","setTimeout"],"mappings":"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","sourcesContent":["import { AUTHENTICATION, DEAUTHENTICATION } from '../constants/constants';\r\nimport cookie from 'js-cookie';\r\nimport Router from 'next/router';\r\nexport const authentication = user => dispatch => \r\n    fetch(`http://localhost:8000/api/signin`, {\r\n        method: 'POST',\r\n        headers: {\r\n            Accept: 'application/json',\r\n            'Content-Type':'application/json'\r\n        },\r\n        body: JSON.stringify(user)\r\n    })\r\n    .then(data => data.json())\r\n    .then(res =>\r\n       {\r\n        setCookie('token', response.token);\r\n        Router.push('/');\r\n         dispatch({type: AUTHENTICATION, payload: res.token})\r\n       })\r\n    .catch(err => console.log(err));\r\n\r\nexport const setCookie = (key, value) => {\r\n    if(process.browser){\r\n        Cookie.set(key, value, {\r\n            exprires: 1,\r\n            path: '/'\r\n        })\r\n    }\r\n};\r\n\r\nexport const removeCookie = key => {\r\n    if(process.browser){\r\n        cookie.remove(key, {\r\n            exprires: 1\r\n        })\r\n    }\r\n}\r\n\r\nexport const getCookie = (key, req) => {\r\n    return  process.browser ? getCookieFromBrowser(key) : getCookieFromServer(key,req);\r\n}\r\n\r\nconst getCookieFromBrowser = key => {\r\n    return cookie.get(key)\r\n}\r\n\r\nconst getCookieFromServer = (key, req) => {\r\n    if(!req.headers.cookie){\r\n        return undefined;\r\n    }\r\n\r\n    const rawCookie = req.headers.cookie.split(';').find(c => c.trim().startsWith(`${key}=`));\r\n    if(!rawCookie){\r\n        return undefined;\r\n    }\r\n\r\n    return rawCookie.split('=')[1];\r\n}\r\n\r\nexport const reauthenticate = token => dispatch => (dispatch({type: AUTHENTICATION, payload: token}));\r\n\r\nexport const deauthenticate = () => dispatch => {\r\n    removeCookie('token');\r\n    Router.push('/');\r\n    dispatch({type: DEAUTHENTICATION});\r\n}\r\n\r\n\r\nexport const checkServerSideCookie = ctx => {\r\n    if (ctx.isServer) {\r\n        if (ctx.req.headers.cookie) {\r\n            const token = getCookie('token', ctx.req);\r\n            ctx.store.dispatch(reauthenticate(token, user));\r\n        }\r\n    } else {\r\n        const token = ctx.store.getState().authentication.token;\r\n\r\n        if (token && user && (ctx.pathname === '/signin' || ctx.pathname === '/signup')) {\r\n            setTimeout(function() {\r\n                Router.push('/');\r\n            }, 0);\r\n        }\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}